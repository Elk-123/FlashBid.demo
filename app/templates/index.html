<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>FlashBid ç«æ‹å®æˆ˜</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 50px; background-color: #f4f4f9; }
        .card { background: white; max-width: 400px; margin: 0 auto; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        .price-box { font-size: 48px; color: #e74c3c; font-weight: bold; margin: 20px 0; }
        .user-box { color: #777; margin-bottom: 20px; }
        button { background-color: #3498db; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 8px; cursor: pointer; transition: 0.3s; }
        button:hover { background-color: #2980b9; transform: scale(1.05); }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #log { margin-top: 20px; font-size: 12px; color: #888; text-align: left; height: 100px; overflow-y: scroll; border-top: 1px solid #eee; padding-top: 10px;}
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸ”¥ æé€Ÿç«æ‹ (Item-1)</h1>
    <div class="price-box">Â¥ <span id="price">...</span></div>
    <div class="user-box">å½“å‰èµ¢å®¶: <span id="winner">...</span></div>
    
    <div style="display: flex; gap: 10px; justify-content: center;">
        <input type="number" id="bidAmount" placeholder="è¾“å…¥é‡‘é¢" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; width: 100px;">
        <button onclick="placeBid()">ğŸ’° ç«‹å³å‡ºä»·</button>
    </div>
    <div id="status" style="margin-top: 15px; height: 20px; color: green;"></div>
</div>

<div id="log" class="card">æ—¥å¿—åŒºåŸŸ...</div>

<script>
    const API_URL = "http://127.0.0.1:8000";
    const ITEM_ID = 1;
    const USER_ID = "Human-" + Math.floor(Math.random() * 1000); // éšæœºç”Ÿæˆä¸€ä¸ªç”¨æˆ·ID

    // 1. è½®è¯¢è·å–æœ€æ–°ä»·æ ¼ (æ¯ç§’ä¸€æ¬¡)
    async function refreshPrice() {
        try {
            const res = await fetch(`${API_URL}/item/${ITEM_ID}`);
            const data = await res.json();
            document.getElementById('price').innerText = data.price;
            document.getElementById('winner').innerText = data.user_id;
            
            // è‡ªåŠ¨æŠŠè¾“å…¥æ¡†å¡«ä¸º å½“å‰ä»· + 10
            // document.getElementById('bidAmount').placeholder = parseFloat(data.price) + 10;
        } catch (e) {
            console.error("è¿æ¥å¤±è´¥", e);
        }
    }

    // 2. å‡ºä»·åŠ¨ä½œ
    async function placeBid() {
        const amount = parseFloat(document.getElementById('bidAmount').value);
        if (!amount) {
            alert("è¯·è¾“å…¥é‡‘é¢ï¼");
            return;
        }

        const log = document.getElementById('log');
        document.getElementById('status').innerText = "æäº¤ä¸­...";

        try {
            const res = await fetch(`${API_URL}/bid`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    item_id: ITEM_ID,
                    user_id: USER_ID,
                    amount: amount
                })
            });
            const data = await res.json();

            if (data.status === 'accepted') {
                document.getElementById('status').innerText = "âœ… å‡ºä»·æˆåŠŸï¼";
                document.getElementById('status').style.color = "green";
                log.innerHTML = `<div>[${new Date().toLocaleTimeString()}] æˆ‘å‡ºä»· ${amount} æˆåŠŸ</div>` + log.innerHTML;
                refreshPrice(); // ç«‹å³åˆ·æ–°
            } else {
                document.getElementById('status').innerText = "âŒ å‡ºä»·å¤±è´¥ (ä»·æ ¼ä½äº†)";
                document.getElementById('status').style.color = "red";
                log.innerHTML = `<div>[${new Date().toLocaleTimeString()}] æˆ‘å‡ºä»· ${amount} å¤±è´¥: ${data.msg}</div>` + log.innerHTML;
            }
        } catch (e) {
            alert("ç½‘ç»œé”™è¯¯");
        }
    }

    // å¯åŠ¨è½®è¯¢
    setInterval(refreshPrice, 1000);
    refreshPrice();
</script>

</body>
</html>